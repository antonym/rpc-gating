---
- hosts: job_nodes
  connection: local
  gather_facts: False
  tasks:
    - name: Get instance info
      rax_facts:
        name: "{{ instance_name }}"
        region: "{{ rax_region }}" # from static inventory file, generated by allocate_pubcloud
      register: get_rax_facts
      delegate_to: localhost
    - name: Cleanup public cloud instances
      rax:
        instance_ids:
          - "{{ rax_id }}"
        state: absent
        wait: yes
        wait_timeout: 900
        auto_increment: no
        region: "{{ rax_region }}"
      when: get_rax_facts |success
      delegate_to: localhost
